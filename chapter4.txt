This is chapter 4 in the master branch.